# Plan â€” Create a Task

Queue a new task with a full implementation plan, persisted to a file.

Usage: `/plan [description]`

**Do not write any code. Do not start implementing. This command ends when the user approves the plan.**

---

## Step 1: Determine the next task number

List existing task files to find the next available number:

```bash
ls .claude/tasks/ | grep -E '^[0-9]{3}-' | sort | tail -1
```

- If no files exist yet, start at `001`
- Otherwise, take the highest number found and increment by 1
- Always zero-pad to 3 digits: `001`, `002`, `023`, `100`

---

## Step 2: Generate the task slug

From the user's description, generate a kebab-case slug of 3â€“5 words:
- `"create new dashboard"` â†’ `create-new-dashboard`
- `"fix auth token expiry bug"` â†’ `fix-auth-token-expiry`
- `"add CSV export to reports"` â†’ `add-csv-export-reports`

The full task ID is: `NNN-slug` (e.g., `003-create-new-dashboard`)

---

## Step 3: Invoke the planner agent

Use the `planner` sub-agent to explore the codebase and produce the plan.

The planner will:
- Ask up to 3 clarifying questions if the description is ambiguous
- Explore the codebase to understand existing patterns
- Produce a plan in its standard output format

Wait for the planner to finish before proceeding.

---

## Step 4: Write the task file

Create `.claude/tasks/NNN-slug.md` using this exact structure:

```markdown
# NNN â€” [Human-readable title from description]

**Status**: TODO
**Created**: [today's date, YYYY-MM-DD]
**Branch**: â€”
**Priority**: [Low / Medium / High â€” infer from context, ask if unclear]

---

## Goal

[1â€“2 sentence description of what needs to be built and why. Use the user's own words.]

## Acceptance Criteria

- [ ] [Derive from the planner's output â€” specific, testable, observable]
- [ ] [Edge cases and error paths covered]
- [ ] [Tests pass at 80%+ coverage]

---

## Plan

> Generated by the planner agent. Do not edit manually.

[Paste the planner agent's full output here verbatim]

---

## Progress Notes

> Updated by Claude during `/feature` execution.

_Not started._

---

## Links

- **PR**: â€”
- **Related tasks**: â€”
```

---

## Step 5: Update TASKS.md

Add the new task to the **ðŸ“‹ To Do** section of `TASKS.md`:

```
- **[NNN](/.claude/tasks/NNN-slug.md)** â€” [Human-readable title] Â· Priority: [Low/Medium/High] Â· Created [YYYY-MM-DD]
```

If the To Do section currently shows `_No tasks queued._`, replace that line with the new entry.

---

## Step 6: Present and wait for approval

Show the user:
1. The task ID that was created (`003-create-new-dashboard`)
2. The full contents of the task file
3. The question: **"Does this plan look correct? Reply 'approved' to queue it, or tell me what to change."**

Do not proceed to implementation. Do not run `/feature`. Wait.

If the user requests changes: update the task file and TASKS.md, then re-present.

---

## When to Use `/plan` vs `/feature`

| Use `/plan` when...                              | Use `/feature [NNN]` when...               |
|--------------------------------------------------|--------------------------------------------|
| Starting something new â€” requirements need review | The task file already exists and is approved |
| You want to surface risks before touching code   | You're ready to start the TDD cycle        |
| Multiple approaches are possible                 | There's a clear, agreed approach           |
